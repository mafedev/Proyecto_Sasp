{% extends "layout.html" %}
{% block title %}Monitorizar{% endblock %}

{% block content %}
<h1 class="mb-4">ğŸ¾ MonitorizaciÃ³n de Especies</h1>

<form method="POST" class="mb-4">
  <label for="especie" class="form-label">Selecciona una especie:</label>
  <select name="especie" class="form-select" onchange="this.form.submit()">
    {% for e in especies %}
      <option value="{{ e }}" {% if e == especie %}selected{% endif %}>{{ e }}</option>
    {% endfor %}
  </select>
</form>

<h3 class="mb-3">ğŸ” Resultados para: {{ especie }}</h3>

{% if registros %}
  <p><strong>âœ… {{ registros|length }} registros encontrados en GBIF</strong></p>

  <div class="row">
    <div class="col-md-6">
      <h5>ğŸ—ºï¸ Mapa de Observaciones</h5>
      <div class="map-container" style="height: 400px;">
        {{ mapa_html|safe }}
      </div>
    </div>
    <div class="col-md-6">
      <h5>ğŸ“Š EvoluciÃ³n Poblacional</h5>
      {% if plot_img %}
        <img src="data:image/png;base64,{{ plot_img }}" class="img-fluid border rounded shadow" alt="GrÃ¡fico de poblaciÃ³n">
      {% else %}
        <div class="alert alert-secondary">âŒ No se pudo generar el grÃ¡fico (datos insuficientes).</div>
      {% endif %}
    </div>
  </div>

  {% if aÃ±o_pred %}
    <hr>
    <h4 class="mt-4">ğŸ“‰ PredicciÃ³n de ExtinciÃ³n</h4>
    <p>ğŸ§  Posible extinciÃ³n en el aÃ±o: <strong>{{ aÃ±o_pred }}</strong></p>
    {% if aÃ±o_pred - 2024 <= 10 %}
      <div class="alert alert-danger">âš ï¸ Riesgo crÃ­tico: extinciÃ³n en menos de 10 aÃ±os.</div>
    {% endif %}
  {% endif %}
{% else %}
  <div class="alert alert-warning">âš ï¸ No se encontraron registros para esta especie.</div>
{% endif %}
{% endblock %}